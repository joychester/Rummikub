BOOMR_start=(new Date).getTime();function BOOMR_check_doc_domain(domain){var test;if(!domain){if(window.parent===window||!document.getElementById("boomr-if-as")){return}domain=document.domain}if(domain.indexOf(".")===-1){return}try{test=window.parent.document;return}catch(err){document.domain=domain}try{test=window.parent.document;return}catch(err){domain=domain.replace(/^[\w\-]+\./,"")}BOOMR_check_doc_domain(domain)}BOOMR_check_doc_domain();(function(w){var impl,boomr,d,myurl,createCustomEvent,dispatchEvent,visibilityState,visibilityChange;if(w.parent!==w&&document.getElementById("boomr-if-as")&&document.getElementById("boomr-if-as").nodeName.toLowerCase()==="script"){w=w.parent;myurl=document.getElementById("boomr-if-as").src}d=w.document;if(!w.BOOMR){w.BOOMR={}}BOOMR=w.BOOMR;if(BOOMR.version){return}BOOMR.version="0.9";BOOMR.window=w;if(!BOOMR.plugins){BOOMR.plugins={}}(function(){try{if(new w.CustomEvent("CustomEvent")!==undefined){createCustomEvent=function(e_name,params){return new w.CustomEvent(e_name,params)}}}catch(ignore){}try{if(!createCustomEvent&&d.createEvent&&d.createEvent("CustomEvent")){createCustomEvent=function(e_name,params){var evt=d.createEvent("CustomEvent");params=params||{cancelable:false,bubbles:false};evt.initCustomEvent(e_name,params.bubbles,params.cancelable,params.detail);return evt}}}catch(ignore){}if(!createCustomEvent&&d.createEventObject){createCustomEvent=function(e_name,params){var evt=d.createEventObject();evt.type=evt.propertyName=e_name;evt.detail=params.detail;return evt}}if(!createCustomEvent){createCustomEvent=function(){return undefined}}})();dispatchEvent=function(e_name,e_data,async){var ev=createCustomEvent(e_name,{detail:e_data});if(!ev){return}function dispatch(){if(d.dispatchEvent){d.dispatchEvent(ev)}else if(d.fireEvent){d.fireEvent("onpropertychange",ev)}}if(async){BOOMR.setImmediate(dispatch)}else{dispatch()}};if(typeof document.hidden!=="undefined"){visibilityState="visibilityState";visibilityChange="visibilitychange"}else if(typeof document.mozHidden!=="undefined"){visibilityState="mozVisibilityState";visibilityChange="mozvisibilitychange"}else if(typeof document.msHidden!=="undefined"){visibilityState="msVisibilityState";visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){visibilityState="webkitVisibilityState";visibilityChange="webkitvisibilitychange"}impl={beacon_url:"",beacon_type:"AUTO",site_domain:w.location.hostname.replace(/.*?([^.]+\.[^.]+)\.?$/,"$1").toLowerCase(),user_ip:"",strip_query_string:false,onloadfired:false,handlers_attached:false,timeout:15e3,events:{page_ready:[],page_unload:[],before_unload:[],dom_loaded:[],visibility_changed:[],before_beacon:[],onbeacon:[],xhr_load:[],click:[],form_submit:[]},public_events:{before_beacon:"onBeforeBoomerangBeacon",onbeacon:"onBoomerangBeacon",onboomerangloaded:"onBoomerangLoaded"},vars:{},errors:{},disabled_plugins:{},xb_handler:function(type){return function(ev){var target;if(!ev){ev=w.event}if(ev.target){target=ev.target}else if(ev.srcElement){target=ev.srcElement}if(target.nodeType===3){target=target.parentNode}if(target&&target.nodeName.toUpperCase()==="OBJECT"&&target.type==="application/x-shockwave-flash"){return}impl.fireEvent(type,target)}},fireEvent:function(e_name,data){var i,handler,handlers;e_name=e_name.toLowerCase();if(!this.events.hasOwnProperty(e_name)){return false}if(this.public_events.hasOwnProperty(e_name)){BOOMR.debug(e_name+"  there is event");dispatchEvent(this.public_events[e_name],data)}BOOMR.debug(e_name+"  Start to handle event");handlers=this.events[e_name];for(i=0;i<handlers.length;i++){try{handler=handlers[i];handler.fn.call(handler.scope,data,handler.cb_data)}catch(err){BOOMR.addError(err,"fireEvent."+e_name+"<"+i+">")}}return true}};boomr={t_lstart:null,t_start:BOOMR_start,t_end:null,url:myurl,utils:{objectToString:function(o,separator,nest_level){var value=[],k;if(!o||typeof o!=="object"){return o}if(separator===undefined){separator="\n	"}if(!nest_level){nest_level=0}if(Object.prototype.toString.call(o)==="[object Array]"){for(k=0;k<o.length;k++){if(nest_level>0&&o[k]!==null&&typeof o[k]==="object"){value.push(this.objectToString(o[k],separator+(separator==="\n	"?"	":""),nest_level-1))}else{if(separator==="&"){value.push(encodeURIComponent(o[k]))}else{value.push(o[k])}}}separator=","}else{for(k in o){if(Object.prototype.hasOwnProperty.call(o,k)){if(nest_level>0&&o[k]!==null&&typeof o[k]==="object"){value.push(encodeURIComponent(k)+"="+this.objectToString(o[k],separator+(separator==="\n	"?"	":""),nest_level-1))}else{if(separator==="&"){value.push(encodeURIComponent(k)+"="+encodeURIComponent(o[k]))}else{value.push(k+"="+o[k])}}}}}return value.join(separator)},getCookie:function(name){if(!name){return null}name=" "+name+"=";var i,cookies;cookies=" "+d.cookie+";";if((i=cookies.indexOf(name))>=0){i+=name.length;cookies=cookies.substring(i,cookies.indexOf(";",i));return cookies}return null},setCookie:function(name,subcookies,max_age){var value,nameval,savedval,c,exp;if(!name||!impl.site_domain){BOOMR.debug("No cookie name or site domain: "+name+"/"+impl.sitze_domain);return false}value=this.objectToString(subcookies,"&");nameval=name+"="+value;c=[nameval,"path=/","domain="+impl.site_domain];if(max_age){exp=new Date;exp.setTime(exp.getTime()+max_age*1e3);exp=exp.toGMTString();c.push("expires="+exp)}if(nameval.length<500){d.cookie=c.join("; ");savedval=this.getCookie(name);if(value===savedval){return true}BOOMR.warn("Saved cookie value doesn't match what we tried to set:\n"+value+"\n"+savedval)}else{BOOMR.warn("Cookie too long: "+nameval.length+" "+nameval)}return false},getSubCookies:function(cookie){var cookies_a,i,l,kv,gotcookies=false,cookies={};if(!cookie){return null}if(typeof cookie!=="string"){BOOMR.debug("TypeError: cookie is not a string: "+typeof cookie);return null}cookies_a=cookie.split("&");for(i=0,l=cookies_a.length;i<l;i++){kv=cookies_a[i].split("=");if(kv[0]){kv.push("");cookies[decodeURIComponent(kv[0])]=decodeURIComponent(kv[1]);gotcookies=true}}return gotcookies?cookies:null},removeCookie:function(name){return this.setCookie(name,{},-86400)},cleanupURL:function(url){if(!url){return""}if(impl.strip_query_string){return url.replace(/\?.*/,"?qs-redacted")}return url},hashQueryString:function(url,stripHash){if(!url){return url}if(!url.match){BOOMR.addError("TypeError: Not a string","hashQueryString",typeof url);return""}if(url.match(/^\/\//)){url=location.protocol+url}if(!url.match(/^(https?|file):/)){BOOMR.error("Passed in URL is invalid: "+url);return""}if(stripHash){url=url.replace(/#.*/,"")}if(!BOOMR.utils.MD5){return url}return url.replace(/\?([^#]*)/,function(m0,m1){return"?"+(m1.length>10?BOOMR.utils.MD5(m1):m1)})},pluginConfig:function(o,config,plugin_name,properties){var i,props=0;if(!config||!config[plugin_name]){return false}for(i=0;i<properties.length;i++){if(config[plugin_name][properties[i]]!==undefined){o[properties[i]]=config[plugin_name][properties[i]];props++}}return props>0},addObserver:function(el,config,timeout,callback,callback_data,callback_ctx){var o={observer:null,timer:null};if(!window.MutationObserver||!callback||!el){return null}function done(mutations){var run_again=false;if(o.timer){clearTimeout(o.timer);o.timer=null}if(callback){run_again=callback.call(callback_ctx,mutations,callback_data);if(!run_again){callback=null}}if(!run_again&&o.observer){o.observer.disconnect();o.observer=null}if(typeof run_again==="number"&&run_again>0){o.timer=setTimeout(done,run_again)}}o.observer=new MutationObserver(done);if(timeout){o.timer=setTimeout(done,o.timeout)}o.observer.observe(el,config);return o},addListener:function(el,type,fn){if(el.addEventListener){el.addEventListener(type,fn,false)}else if(el.attachEvent){el.attachEvent("on"+type,fn)}},removeListener:function(el,type,fn){if(el.removeEventListener){el.removeEventListener(type,fn,false)}else if(el.detachEvent){el.detachEvent("on"+type,fn)}},pushVars:function(form,vars,prefix){var k,i,l=0,input;for(k in vars){if(vars.hasOwnProperty(k)){if(Object.prototype.toString.call(vars[k])==="[object Array]"){for(i=0;i<vars[k].length;++i){l+=BOOMR.utils.pushVars(form,vars[k][i],k+"["+i+"]")}}else{input=document.createElement("input");input.type="hidden";input.name=prefix?prefix+"["+k+"]":k;input.value=vars[k]===undefined||vars[k]===null?"":vars[k];form.appendChild(input);l+=encodeURIComponent(input.name).length+encodeURIComponent(input.value).length+2}}}return l},sendData:function(form,method){var input=document.createElement("input"),urls=[impl.beacon_url];form.method=method;form.id="beacon_form";form.enctype="application/x-www-form-urlencoded";if(impl.secondary_beacons&&impl.secondary_beacons.length){urls.push.apply(urls,impl.secondary_beacons)}function remove(id){var el=document.getElementById(id);if(el){el.parentNode.removeChild(el)}}function submit(){var iframe,name="boomerang_post-"+encodeURIComponent(form.action)+"-"+Math.random();try{iframe=document.createElement('<iframe name="'+name+'">')}catch(ignore){iframe=document.createElement("iframe")}form.action=urls.shift();form.target=iframe.name=iframe.id=name;iframe.style.display=form.style.display="none";iframe.src="javascript:false";remove(iframe.id);remove(form.id);document.body.appendChild(iframe);document.body.appendChild(form);form.submit();if(urls.length){BOOMR.setImmediate(submit)}setTimeout(function(){remove(iframe.id)},1e4)}submit()}},init:function(config){var i,k,properties=["beacon_url","beacon_type","site_domain","user_ip","strip_query_string","secondary_beacons"];BOOMR_check_doc_domain();if(!config){config={}}for(i=0;i<properties.length;i++){if(config[properties[i]]!==undefined){impl[properties[i]]=config[properties[i]]}}if(config.log!==undefined){this.log=config.log}if(!this.log){this.log=function(){}}var t=impl.timeout;impl.timeoutID=w.setTimeout(function(){BOOMR.sendMyData("timeout",t);impl.onloadfired=true},t);for(k in this.plugins){if(this.plugins.hasOwnProperty(k)){if(config[k]&&config[k].hasOwnProperty("enabled")&&config[k].enabled===false){impl.disabled_plugins[k]=1;continue}if(impl.disabled_plugins[k]){if(!config[k]||!config[k].hasOwnProperty("enabled")||config[k].enabled!==true){continue}delete impl.disabled_plugins[k]}if(typeof this.plugins[k].init==="function"){try{this.plugins[k].init(config)}catch(err){BOOMR.addError(err,k+".init")}}}}if(impl.handlers_attached){return this}if(!impl.onloadfired&&(config.autorun===undefined||config.autorun!==false)){if(d.readyState&&d.readyState==="complete"){BOOMR.loadedLate=true;this.setImmediate(BOOMR.page_ready,null,null,BOOMR)}else{if(w.onpagehide||w.onpagehide===null){BOOMR.utils.addListener(w,"pageshow",BOOMR.page_ready)}else{BOOMR.utils.addListener(w,"load",BOOMR.page_ready)}}}BOOMR.utils.addListener(w,"DOMContentLoaded",function(){impl.fireEvent("dom_loaded")});(function(){var forms,iterator;if(visibilityChange!==undefined){BOOMR.utils.addListener(d,visibilityChange,function(){impl.fireEvent("visibility_changed")});BOOMR.subscribe("visibility_changed",function(){BOOMR.lastVisibilityEvent[BOOMR.visibilityState()]=BOOMR.now()})}BOOMR.utils.addListener(d,"mouseup",impl.xb_handler("click"));forms=d.getElementsByTagName("form");for(iterator=0;iterator<forms.length;iterator++){BOOMR.utils.addListener(forms[iterator],"submit",impl.xb_handler("form_submit"))}if(!w.onpagehide&&w.onpagehide!==null){BOOMR.utils.addListener(w,"unload",function(){BOOMR.window=w=null})}})();impl.handlers_attached=true;return this},page_ready:function(ev){if(!ev){ev=w.event}if(!ev){ev={name:"load"}}if(impl.onloadfired){return this}impl.fireEvent("page_ready",ev);impl.onloadfired=true;w.clearTimeout(impl.timeoutID);return this},setImmediate:function(fn,data,cb_data,cb_scope){var cb=function(){fn.call(cb_scope||null,data,cb_data||{});cb=null};if(w.setImmediate){w.setImmediate(cb)}else if(w.msSetImmediate){w.msSetImmediate(cb)}else if(w.webkitSetImmediate){w.webkitSetImmediate(cb)}else if(w.mozSetImmediate){w.mozSetImmediate(cb)}else{setTimeout(cb,10)}},now:function(){try{if("performance"in window&&window.performance&&window.performance.now){return function(){return Math.round(window.performance.now()+window.performance.timing.navigationStart)}}}catch(ignore){}return Date.now||function(){return(new Date).getTime()}}(),visibilityState:visibilityState===undefined?function(){return"visible"}:function(){return d[visibilityState]},lastVisibilityEvent:{},subscribe:function(e_name,fn,cb_data,cb_scope){var i,handler,ev,unload_handler;e_name=e_name.toLowerCase();if(!impl.events.hasOwnProperty(e_name)){return this}ev=impl.events[e_name];for(i=0;i<ev.length;i++){handler=ev[i];if(handler&&handler.fn===fn&&handler.cb_data===cb_data&&handler.scope===cb_scope){return this}}ev.push({fn:fn,cb_data:cb_data||{},scope:cb_scope||null});if(e_name==="page_ready"&&impl.onloadfired){this.setImmediate(fn,null,cb_data,cb_scope)}if(e_name==="page_unload"||e_name==="before_unload"){unload_handler=function(evt){if(fn){fn.call(cb_scope,evt||w.event,cb_data)}};if(e_name==="page_unload"){if(w.onpagehide||w.onpagehide===null){BOOMR.utils.addListener(w,"pagehide",unload_handler)}else{BOOMR.utils.addListener(w,"unload",unload_handler)}}BOOMR.utils.addListener(w,"beforeunload",unload_handler)}return this},addError:function(err,src,extra){var str;if(typeof err!=="string"){str=String(err);if(str.match(/^\[object/)){str=err.name+": "+(err.description||err.message).replace(/\r\n$/,"")}err=str}if(src!==undefined){err="["+src+":"+BOOMR.now()+"] "+err}if(extra){err+=":: "+extra}if(impl.errors[err]){impl.errors[err]++}else{impl.errors[err]=1}},addVar:function(name,value){if(typeof name==="string"){impl.vars[name]=value}else if(typeof name==="object"){var o=name,k;for(k in o){if(o.hasOwnProperty(k)){impl.vars[k]=o[k]}}}return this},removeVar:function(arg0){var i,params;if(!arguments.length){return this}if(arguments.length===1&&Object.prototype.toString.apply(arg0)==="[object Array]"){params=arg0}else{params=arguments}for(i=0;i<params.length;i++){if(impl.vars.hasOwnProperty(params[i])){delete impl.vars[params[i]]}}return this},clearVars:function(){BOOMR.debug("Watch out! Your are clearing Vars!!!!");impl.vars={}},clearVarsByWL:function(whiteList){for(name in impl.vars){if(whiteList.indexOf(name)===-1){delete impl.vars.name;BOOMR.debug("Hey I'm clearing vars."+name)}}},hasVar:function(name){return impl.vars.hasOwnProperty(name)},requestStart:function(name){var t_start=BOOMR.now();BOOMR.plugins.RT.startTimer("xhr_"+name,t_start);return{loaded:function(data){BOOMR.responseEnd(name,t_start,data)}}},responseEnd:function(name,t_start,data){if(typeof name==="object"&&name.url){impl.fireEvent("xhr_load",name)}else{BOOMR.plugins.RT.startTimer("xhr_"+name,t_start);impl.fireEvent("xhr_load",{name:"xhr_"+name,data:data})}},sendMyData:function(name,value){BOOMR.addVar(name,value);BOOMR.debug("What happened");var k,form,furl,img,length,errors=[];impl.vars.pgu=BOOMR.utils.cleanupURL(d.URL.replace(/#.*/,""));if(!impl.vars.u){impl.vars.u=impl.vars.pgu}if(impl.vars.pgu===impl.vars.u){delete impl.vars.pgu}if(w!==window){impl.vars["if"]=""}for(k in impl.errors){if(impl.errors.hasOwnProperty(k)){errors.push(k+(impl.errors[k]>1?" (*"+impl.errors[k]+")":""))}}if(errors.length>0){impl.vars.errors=errors.join("\n")}impl.errors={};impl.fireEvent("before_beacon",impl.vars);BOOMR.debug("Ready to send beacon: "+BOOMR.utils.objectToString(impl.vars));if(!impl.beacon_url){BOOMR.debug("No beacon URL, so skipping.");return true}form=document.createElement("form");length=BOOMR.utils.pushVars(form,impl.vars);impl.fireEvent("onbeacon",impl.vars);if(!length){return this}console.log("Really Ready to fire beacon:"+window.performance.now());BOOMR.utils.sendData(form,impl.beacon_type==="AUTO"?length>2e3?"POST":"GET":"POST");return true},sendBeacon:function(){var k,form,furl,img,length,errors=[];BOOMR.debug("Checking if we can send beacon");for(k in this.plugins){if(this.plugins.hasOwnProperty(k)){if(impl.disabled_plugins[k]){continue}if(!this.plugins[k].is_complete()){BOOMR.debug("Plugin "+k+" is not complete, deferring beacon send");return false}}}impl.vars.pgu=BOOMR.utils.cleanupURL(d.URL.replace(/#.*/,""));if(!impl.vars.u){impl.vars.u=impl.vars.pgu}if(impl.vars.pgu===impl.vars.u){delete impl.vars.pgu}if(BOOMR.visibilityState()){impl.vars["vis.st"]=BOOMR.visibilityState();if(BOOMR.lastVisibilityEvent.visible){impl.vars["vis.lv"]=BOOMR.now()-BOOMR.lastVisibilityEvent.visible}if(BOOMR.lastVisibilityEvent.hidden){impl.vars["vis.lh"]=BOOMR.now()-BOOMR.lastVisibilityEvent.hidden}}if(w!==window){impl.vars["if"]=""}for(k in impl.errors){if(impl.errors.hasOwnProperty(k)){errors.push(k+(impl.errors[k]>1?" (*"+impl.errors[k]+")":""))}}if(errors.length>0){impl.vars.errors=errors.join("\n")}impl.errors={};impl.fireEvent("before_beacon",impl.vars);BOOMR.debug("Ready to send beacon: "+BOOMR.utils.objectToString(impl.vars));if(!impl.beacon_url){BOOMR.debug("No beacon URL, so skipping.");return true}var varWhiteList=["user_timing","t_resp","t_page","t_done","t_other","u"];for(name in impl.vars){if(varWhiteList.indexOf(name)===-1)delete impl.vars[name]}form=document.createElement("form");length=BOOMR.utils.pushVars(form,impl.vars);impl.fireEvent("onbeacon",impl.vars);if(!length){return this}console.log("Really Ready to fire beacon:"+window.performance.now());BOOMR.utils.sendData(form,impl.beacon_type==="AUTO"?length>2e3?"POST":"GET":"POST");BOOMR.clearVars();return true}};delete BOOMR_start;if(typeof BOOMR_lstart==="number"){boomr.t_lstart=BOOMR_lstart;delete BOOMR_lstart}else if(typeof BOOMR.window.BOOMR_lstart==="number"){boomr.t_lstart=BOOMR.window.BOOMR_lstart}(function(){var make_logger;if(typeof console==="object"&&console.log!==undefined){boomr.log=function(m,l,s){console.log(s+": ["+l+"] "+m)}}make_logger=function(l){return function(m,s){this.log(m,l,"boomerang"+(s?"."+s:""));return this}};boomr.debug=make_logger("debug");boomr.info=make_logger("info");boomr.warn=make_logger("warn");boomr.error=make_logger("error")})();(function(){var ident;for(ident in boomr){if(boomr.hasOwnProperty(ident)){BOOMR[ident]=boomr[ident]}}if(!BOOMR.xhr_excludes){BOOMR.xhr_excludes={}}})();dispatchEvent("onBoomerangLoaded",{BOOMR:BOOMR},true)})(window);(function(w){var d=w.document,impl;BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(BOOMR.plugins.RT){return}impl={onloadfired:false,unloadfired:false,visiblefired:false,initialized:false,complete:false,timers:{},cookie:"RT",cookie_exp:600,strict_referrer:true,navigationType:0,navigationStart:undefined,responseStart:undefined,t_start:undefined,cached_t_start:undefined,t_fb_approx:undefined,r:undefined,r2:undefined,basic_timers:{t_done:1,t_resp:1,t_page:1},addedVars:[],updateCookie:function(params,timer){var t_end,t_start,subcookies,k;if(!this.cookie){return false}subcookies=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie))||{};if(typeof params==="object"){for(k in params){if(params.hasOwnProperty(k)){if(params[k]===undefined){if(subcookies.hasOwnProperty(k)){delete subcookies[k]}}else{if(k==="nu"||k==="r"){params[k]=BOOMR.utils.hashQueryString(params[k],true)}subcookies[k]=params[k]}}}}t_start=BOOMR.now();if(timer){subcookies[timer]=t_start}BOOMR.debug("Setting cookie (timer="+timer+")\n"+BOOMR.utils.objectToString(subcookies),"rt");if(!BOOMR.utils.setCookie(this.cookie,subcookies,this.cookie_exp)){BOOMR.error("cannot set start cookie","rt");return false}t_end=BOOMR.now();if(t_end-t_start>50){BOOMR.utils.removeCookie(this.cookie);BOOMR.error("took more than 50ms to set cookie... aborting: "+t_start+" -> "+t_end,"rt")}return true},initFromCookie:function(){var url,subcookies;subcookies=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie));if(!subcookies){return}subcookies.s=Math.max(+subcookies.ul||0,+subcookies.cl||0);BOOMR.debug("Read from cookie "+BOOMR.utils.objectToString(subcookies),"rt");if(subcookies.s&&(subcookies.r||subcookies.nu)){this.r=subcookies.r;url=BOOMR.utils.hashQueryString(d.URL,true);BOOMR.debug(this.r+" =?= "+this.r2,"rt");BOOMR.debug(subcookies.s+" <? "+(+subcookies.cl+15),"rt");BOOMR.debug(subcookies.nu+" =?= "+url,"rt");if(!this.strict_referrer||subcookies.nu&&subcookies.nu===url&&subcookies.s<+subcookies.cl+15||subcookies.s===+subcookies.ul&&this.r===this.r2){this.t_start=subcookies.s;if(+subcookies.hd>subcookies.s){this.t_fb_approx=parseInt(subcookies.hd,10)}}else{this.t_start=this.t_fb_approx=undefined}}this.updateCookie({s:undefined,r:undefined,nu:undefined,ul:undefined,cl:undefined,hd:undefined})},getBoomerangTimings:function(){var res,k,urls,url,startTime,data;function trimTiming(time,st){var timeMs=Math.round(time?time:0),startTimeMs=Math.round(st?st:0);timeMs=timeMs===0?0:timeMs-startTimeMs;return timeMs?timeMs:""}if(BOOMR.t_start){BOOMR.plugins.RT.startTimer("boomerang",BOOMR.t_start);BOOMR.plugins.RT.endTimer("boomerang",BOOMR.t_end);BOOMR.plugins.RT.endTimer("boomr_fb",BOOMR.t_start);if(BOOMR.t_lstart){BOOMR.plugins.RT.endTimer("boomr_ld",BOOMR.t_lstart);BOOMR.plugins.RT.setTimer("boomr_lat",BOOMR.t_start-BOOMR.t_lstart)}}try{if(window.performance&&window.performance.getEntriesByName){urls={"rt.bmr":BOOMR.url};for(url in urls){if(urls.hasOwnProperty(url)&&urls[url]){res=window.performance.getEntriesByName(urls[url]);if(!res||res.length===0){continue}res=res[0];startTime=trimTiming(res.startTime,0);data=[startTime,trimTiming(res.responseEnd,startTime),trimTiming(res.responseStart,startTime),trimTiming(res.requestStart,startTime),trimTiming(res.connectEnd,startTime),trimTiming(res.secureConnectionStart,startTime),trimTiming(res.connectStart,startTime),trimTiming(res.domainLookupEnd,startTime),trimTiming(res.domainLookupStart,startTime),trimTiming(res.redirectEnd,startTime),trimTiming(res.redirectStart,startTime)].join(",").replace(/,+$/,"");BOOMR.addVar(url,data);impl.addedVars.push(url)}}}}catch(e){BOOMR.addError(e,"rt.getBoomerangTimings")}},checkPreRender:function(){if(BOOMR.visibilityState()!=="prerender"){return false}BOOMR.plugins.RT.startTimer("t_load",this.navigationStart);BOOMR.plugins.RT.endTimer("t_load");BOOMR.plugins.RT.startTimer("t_prerender",this.navigationStart);BOOMR.plugins.RT.startTimer("t_postrender");return true},initFromNavTiming:function(){var ti,p,source;if(this.navigationStart){return}p=w.performance||w.msPerformance||w.webkitPerformance||w.mozPerformance;if(p&&p.navigation){this.navigationType=p.navigation.type}if(p&&p.timing){ti=p.timing}else if(w.chrome&&w.chrome.csi&&w.chrome.csi().startE){ti={navigationStart:w.chrome.csi().startE};source="csi"}else if(w.gtbExternal&&w.gtbExternal.startE()){ti={navigationStart:w.gtbExternal.startE()};source="gtb"}if(ti){BOOMR.addVar("rt.start",source||"navigation");this.navigationStart=ti.navigationStart||ti.fetchStart||undefined;this.responseStart=ti.responseStart||undefined;if(navigator.userAgent.match(/Firefox\/[78]\./)){this.navigationStart=ti.unloadEventStart||ti.fetchStart||undefined}}else{BOOMR.warn("This browser doesn't support the WebTiming API","rt")}return},validateLoadTimestamp:function(t_now,data){var t_done=t_now;if(data&&data.timing&&data.timing.loadEventEnd){t_done=data.timing.loadEventEnd}else if(BOOMR.loadedLate){if(w.performance&&w.performance.timing){if(w.performance.timing.loadEventStart&&w.performance.timing.loadEventStart<BOOMR.t_end){t_done=w.performance.timing.loadEventStart}}else{t_done=BOOMR.t_lstart||BOOMR.t_start||t_now}}return t_done},setPageLoadTimers:function(ename,t_done,data){var t_resp_start;if(ename!=="xhr"){impl.initFromCookie();impl.initFromNavTiming();if(impl.checkPreRender()){return false}}if(ename==="xhr"){if(data&&data.timing){t_resp_start=data.timing.responseStart}}else if(impl.responseStart){t_resp_start=impl.responseStart}else if(impl.timers.hasOwnProperty("t_page")){BOOMR.plugins.RT.endTimer("t_page")}else if(impl.t_fb_approx){t_resp_start=impl.t_fb_approx}if(t_resp_start){BOOMR.plugins.RT.endTimer("t_resp",t_resp_start);if(impl.timers.t_load){BOOMR.plugins.RT.setTimer("t_page",impl.timers.t_load.end-t_resp_start)}else{BOOMR.plugins.RT.setTimer("t_page",t_done-t_resp_start)}}if(impl.timers.hasOwnProperty("t_postrender")){BOOMR.plugins.RT.endTimer("t_postrender");BOOMR.plugins.RT.endTimer("t_prerender")}return true},setSupportingTimestamps:function(t_start){if(t_start){BOOMR.addVar("rt.tstart",t_start)}if(typeof impl.t_start==="number"&&impl.t_start!==t_start){BOOMR.addVar("rt.cstart",impl.t_start)}BOOMR.addVar("rt.bstart",BOOMR.t_start);if(BOOMR.t_lstart){BOOMR.addVar("rt.blstart",BOOMR.t_lstart)}BOOMR.addVar("rt.end",impl.timers.t_done.end)},determineTStart:function(ename,data){var t_start;if(ename==="xhr"){if(data&&data.name&&impl.timers[data.name]){t_start=impl.timers[data.name].start}else if(data&&data.timing&&data.timing.requestStart){t_start=data.timing.requestStart}BOOMR.addVar("rt.start","manual")}else if(impl.navigationStart){t_start=impl.navigationStart}else if(impl.t_start&&impl.navigationType!==2){t_start=impl.t_start;BOOMR.addVar("rt.start","cookie")}else if(impl.cached_t_start){t_start=impl.cached_t_start}else{BOOMR.addVar("rt.start","none");t_start=undefined}BOOMR.debug("Got start time: "+t_start,"rt");impl.cached_t_start=t_start;return t_start},page_ready:function(){this.onloadfired=true},check_visibility:function(){if(BOOMR.visibilityState()==="visible"){impl.visiblefired=true}if(impl.visibilityState==="prerender"&&BOOMR.visibilityState()!=="prerender"){BOOMR.plugins.RT.done(null,"visible")}impl.visibilityState=BOOMR.visibilityState()},page_unload:function(edata){BOOMR.debug("Unload called with "+BOOMR.utils.objectToString(edata)+" when unloadfired = "+this.unloadfired,"rt");if(!this.unloadfired){BOOMR.plugins.RT.done(edata,"unload")}this.updateCookie({r:d.URL},edata.type==="beforeunload"?"ul":"hd");this.unloadfired=true},_iterable_click:function(name,element,etarget,value_cb){var value;if(!etarget){return}BOOMR.debug(name+" called with "+etarget.nodeName,"rt");while(etarget&&etarget.nodeName.toUpperCase()!==element){etarget=etarget.parentNode}if(etarget&&etarget.nodeName.toUpperCase()===element){BOOMR.debug("passing through","rt");value=value_cb(etarget);this.updateCookie({nu:value},"cl");BOOMR.addVar("nu",BOOMR.utils.cleanupURL(value));impl.addedVars.push("nu")}},onclick:function(etarget){impl._iterable_click("Click","A",etarget,function(t){return t.href})},onsubmit:function(etarget){impl._iterable_click("Submit","FORM",etarget,function(t){var v=t.getAttribute("action")||d.URL||"";return v.match(/\?/)?v:v+"?"})},domloaded:function(){BOOMR.plugins.RT.endTimer("t_domloaded")},clear:function(vars){if(impl.addedVars&&impl.addedVars.length>0){BOOMR.removeVar(impl.addedVars);impl.addedVars=[]}}};BOOMR.plugins.RT={init:function(config){BOOMR.debug("init RT","rt");if(w!==BOOMR.window){w=BOOMR.window}d=w.document;BOOMR.utils.pluginConfig(impl,config,"RT",["cookie","cookie_exp","strict_referrer"]);impl.r=impl.r2=BOOMR.utils.hashQueryString(d.referrer,true);impl.initFromCookie();impl.getBoomerangTimings();if(impl.initialized){return this}impl.complete=false;impl.timers={};impl.check_visibility();BOOMR.subscribe("page_ready",impl.page_ready,null,impl);BOOMR.subscribe("visibility_changed",impl.check_visibility,null,impl);BOOMR.subscribe("page_ready",this.done,"load",this);BOOMR.subscribe("xhr_load",this.done,"xhr",this);BOOMR.subscribe("dom_loaded",impl.domloaded,null,impl);BOOMR.subscribe("click",impl.onclick,null,impl);BOOMR.subscribe("form_submit",impl.onsubmit,null,impl);BOOMR.subscribe("before_beacon",this.addTimersToBeacon,"beacon",this);BOOMR.subscribe("onbeacon",impl.clear,null,impl);impl.initialized=true;return this},startTimer:function(timer_name,time_value){if(timer_name){if(timer_name==="t_page"){this.endTimer("t_resp",time_value)}impl.timers[timer_name]={start:typeof time_value==="number"?time_value:BOOMR.now()}}return this},endTimer:function(timer_name,time_value){if(timer_name){impl.timers[timer_name]=impl.timers[timer_name]||{};if(impl.timers[timer_name].end===undefined){impl.timers[timer_name].end=typeof time_value==="number"?time_value:BOOMR.now()}}return this},setTimer:function(timer_name,time_delta){if(timer_name){impl.timers[timer_name]={delta:time_delta}}return this},addTimersToBeacon:function(vars,source){var t_name,timer,t_other=[];for(t_name in impl.timers){if(impl.timers.hasOwnProperty(t_name)){timer=impl.timers[t_name];if(typeof timer.delta!=="number"){if(typeof timer.start!=="number"){timer.start=impl.cached_t_start}timer.delta=timer.end-timer.start}if(isNaN(timer.delta)){continue}if(impl.basic_timers.hasOwnProperty(t_name)){BOOMR.addVar(t_name,timer.delta);impl.addedVars.push(t_name)}else{t_other.push(t_name+"|"+timer.delta)}}}if(t_other.length){BOOMR.addVar("t_other",t_other.join(","));impl.addedVars.push("t_other")}if(source==="beacon"){impl.timers={};impl.complete=false}},done:function(edata,ename){try{BOOMR.debug("Called done with "+BOOMR.utils.objectToString(edata,undefined,1)+", "+ename,"rt")}catch(err){BOOMR.debug("Called done with "+err+", "+ename,"rt")}var t_start,t_done,t_now=BOOMR.now(),subresource=false;impl.complete=false;t_done=impl.validateLoadTimestamp(t_now,edata);if(ename==="load"||ename==="visible"||ename==="xhr"){if(!impl.setPageLoadTimers(ename,t_done,edata)){return this}}t_start=impl.determineTStart(ename,edata);if(edata&&edata.data){edata=edata.data}if(ename==="xhr"&&edata){subresource=edata.subresource}this.endTimer("t_done",t_done);BOOMR.removeVar("t_done","t_page","t_resp","t_postrender","t_prerender","t_load","t_other","r","r2","rt.tstart","rt.cstart","rt.bstart","rt.end","rt.subres","rt.abld","http.errno","http.method","xhr.sync");impl.setSupportingTimestamps(t_start);this.addTimersToBeacon();BOOMR.addVar("r",BOOMR.utils.cleanupURL(impl.r));if(impl.r2!==impl.r){BOOMR.addVar("r2",BOOMR.utils.cleanupURL(impl.r2))}if(ename==="xhr"&&edata){if(edata&&edata.data){edata=edata.data}}if(ename==="xhr"&&edata){subresource=edata.subresource;if(edata.url){BOOMR.addVar("u",BOOMR.utils.cleanupURL(edata.url.replace(/#.*/,"")));impl.addedVars.push("u")}if(edata.status&&(edata.status<-1||edata.status>=400)){BOOMR.addVar("http.errno",edata.status)}if(edata.method&&edata.method!=="GET"){BOOMR.addVar("http.method",edata.method)}if(edata.headers){BOOMR.addVar("http.hdr",edata.headers)}if(edata.synchronous){BOOMR.addVar("xhr.sync",1)}if(edata.initiator){BOOMR.addVar("http.initiator",edata.initiator)}impl.addedVars.push("http.errno","http.method","http.hdr","xhr.sync","http.initiator")}if(subresource){BOOMR.addVar("rt.subres",1);impl.addedVars.push("rt.subres")}impl.updateCookie();if(ename==="unload"){BOOMR.addVar("rt.quit","");if(!impl.onloadfired){BOOMR.addVar("rt.abld","")}if(!impl.visiblefired){BOOMR.addVar("rt.ntvu","")}}impl.complete=true;BOOMR.sendBeacon();return this},sendMyData:function(name,value){impl.complete=false;BOOMR.removeVar("t_done","t_page","t_resp","t_postrender","t_prerender","t_load","t_other","r","r2","rt.tstart","rt.cstart","rt.bstart","rt.end","rt.subres","rt.abld","http.errno","http.method","xhr.sync");BOOMR.addVar(name,value);impl.addedVars.push(name);impl.complete=true;BOOMR.sendBeacon();return this},is_complete:function(){return impl.complete}}})(window);BOOMR.init({beacon_url:"/rest/beacon",autorun:false});